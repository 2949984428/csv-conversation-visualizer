# CSV对话数据可视化工具 - 使用指南

## 🎯 快速开始

### 方式一：一键启动（推荐）
```bash
cd csv-visualizer
./start.sh
```

### 方式二：手动启动
```bash
cd csv-visualizer
npm install  # 首次运行需要
npm start
```

然后打开浏览器访问: `http://localhost:3000`

## 📋 完整使用流程

### 第1步：上传CSV文件
1. **拖拽上传**: 直接将CSV文件拖到页面中的上传区域
2. **点击上传**: 点击上传区域选择文件
3. **文件要求**: 
   - 格式: .csv
   - 大小: ≤ 100MB
   - 编码: UTF-8

### 第2步：查看自动分析结果
系统会自动分析你的CSV文件：
- ✅ **文件信息**: 文件名、行数、列数
- ✅ **数据类型**: 单轮对话/多轮对话/自定义
- ✅ **字段检测**: input/output/sessionId/timestamp等
- ✅ **媒体文件**: 是否包含图片/视频链接
- ✅ **智能推荐**: 自动推荐最适合的模板

### 第3步：选择展示模板

#### 🗣️ 单轮对话模板
**适用场景**: 每行是独立的对话记录
**特点**:
- 表格式布局，清晰直观
- 支持图片/视频预览
- 实时搜索功能
- 分页浏览大数据

#### 🔄 多轮对话模板  
**适用场景**: 有会话ID关联的多轮对话
**特点**:
- 按会话分组展示
- 时间线形式
- 可展开/收起对话详情
- 轮次编号显示

#### ⚙️ 自定义模板
**适用场景**: 任意CSV格式，自定义展示
**特点**:
- 手动选择要展示的列
- 灵活的数据视图
- 适配各种CSV结构

### 第4步：生成预览
1. 点击 **"生成预览"** 按钮
2. 查看前20条数据的展示效果
3. 确认样式和布局是否满意

### 第5步：下载HTML文件
1. 点击 **"下载HTML文件"** 按钮
2. 系统自动生成完整的可视化页面
3. 文件自动下载，包含所有功能：
   - 搜索功能
   - 分页浏览
   - 媒体预览
   - 批量下载

## 🎨 支持的数据格式

### 标准格式
```csv
id,timestamp,userId,sessionId,input,output
"abc-123","2025-01-01T10:00:00Z","user1","session1","用户问题","AI回答"
```

### JSON嵌套格式（自动解析）
你的CSV文件格式完全支持：
```csv
id,input,output,sessionId,timestamp
"xxx","{"user_input":"[{\"type\": \"text\", \"text\": \"用户消息\"}, {\"type\": \"image\", \"image_url\": \"图片链接\"}]"}","AI处理步骤...","session1","2025-01-01T10:00:00Z"
```

### 自动排除的字段
按你的要求，以下字段会被自动过滤：
- `latency` (延迟)
- `level` (级别) 
- `observationCount` (观察数)

## 🖼️ 媒体文件支持

### 支持的格式
- **图片**: .jpg, .jpeg, .png, .gif
- **视频**: .mp4, .webm

### 功能特性
- **智能提取**: 从JSON字段中自动提取媒体URL
- **预览功能**: 点击缩略图可大图预览
- **下载功能**: 单个下载或批量下载所有媒体
- **新窗口打开**: 在新标签页中查看原始文件

## 🔧 高级功能

### 搜索功能
- 支持搜索对话内容
- 支持搜索用户ID
- 支持搜索会话ID
- 实时过滤结果

### 分页浏览
- 可选择每页显示数量 (10/20/50条)
- 大数据集高效加载
- 流畅的翻页体验

### 数据统计
- 实时显示记录数量
- 媒体文件数量统计
- 搜索结果数量显示

## 🚨 故障排除

### 服务器启动问题
```bash
# 检查端口占用
lsof -i :3000

# 杀死占用进程
kill -9 <PID>

# 或使用其他端口启动
PORT=3001 npm start
```

### 文件上传失败
1. **文件太大**: 确保文件 < 100MB
2. **格式错误**: 确保是 .csv 格式
3. **编码问题**: 确保使用 UTF-8 编码
4. **网络问题**: 检查网络连接

### 数据解析错误
1. **CSV格式**: 确保CSV格式正确，逗号分隔
2. **引号问题**: 确保字符串正确使用双引号包围
3. **特殊字符**: 确保特殊字符正确转义

## 💡 最佳实践

### 数据准备
1. **清理数据**: 移除无用的列和行
2. **统一格式**: 确保时间戳格式一致
3. **检查编码**: 使用UTF-8编码保存CSV

### 性能优化
1. **文件大小**: 建议单文件 < 50MB 以获得最佳体验
2. **数据量**: 超过10万行建议分批处理
3. **媒体文件**: 外链媒体文件加载速度取决于源服务器

### 使用技巧
1. **预览优先**: 先生成预览确认效果再下载
2. **模板选择**: 根据数据特点选择合适模板
3. **定期备份**: 重要的可视化结果建议多处保存

## 📞 技术支持

如遇到问题：
1. 查看浏览器控制台错误信息
2. 检查服务器日志输出  
3. 确认CSV文件格式正确
4. 尝试使用小文件测试

---

**版本**: v1.0.0  
**更新**: 2025-01-19  
**兼容**: Chrome, Firefox, Safari, Edge